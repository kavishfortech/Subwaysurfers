<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KAVISHFORTECH | SUBWAY RUNNER</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@700&display=swap');
        :root { --rail-color: #555; --ground: #d2691e; }
        * { box-sizing: border-box; margin: 0; padding: 0; touch-action: none; }
        body { background: #87CEEB; font-family: sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; }

        #gameWrapper {
            margin-top: 5vh; width: 95vw; max-width: 400px; height: 60vh;
            border: 4px solid #333; position: relative; background: #f4a460; overflow: hidden;
            border-bottom: none; border-radius: 20px 20px 0 0;
        }

        canvas { width: 100%; height: 100%; display: block; }
        .hud { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-around; font-family: 'Syncopate'; color: white; text-shadow: 2px 2px #000; z-index: 10; }

        .controls { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; width: 95vw; max-width: 400px; margin-top: 10px; }
        .btn { height: 60px; background: #333; color: white; border: none; border-radius: 10px; font-weight: bold; font-size: 1.2rem; }
        .btn:active { background: #555; }
        .special-btns { grid-column: span 3; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .jump-btn { background: #ff4500; }
        .roll-btn { background: #1e90ff; }

        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.8); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: white; text-align: center; }
    </style>
</head>
<body>

    <div id="gameWrapper">
        <div class="hud">
            <div>COINS: <span id="coins">0</span></div>
            <div>SCORE: <span id="score">0</span></div>
        </div>
        <canvas id="subwayCanvas"></canvas>
        <div id="deathMsg" class="overlay">
            <h1 style="font-family:'Syncopate'">BUSTED!</h1>
            <button onclick="game.init()" style="margin-top:20px; padding:15px 30px; font-weight:bold; cursor:pointer;">TRY AGAIN</button>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onpointerdown="game.move(-1)">LEFT</button>
        <button class="btn" onpointerdown="game.move(0)">MID</button>
        <button class="btn" onpointerdown="game.move(1)">RIGHT</button>
        <div class="special-btns">
            <button class="btn jump-btn" onpointerdown="game.jump()">JUMP</button>
            <button class="btn roll-btn" onpointerdown="game.roll()">ROLL</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('subwayCanvas');
        const ctx = canvas.getContext('2d');

        const game = {
            active: false, score: 0, coins: 0, lane: 0, 
            y: 0, vY: 0, isJumping: false, isRolling: false, rollTimer: 0,
            objects: [], speed: 0.04,

            init() {
                canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
                this.active = true; this.score = 0; this.coins = 0; this.lane = 0;
                this.y = 0; this.vY = 0; this.objects = []; this.speed = 0.04;
                document.getElementById('deathMsg').style.display = 'none';
                this.loop();
            },

            move(l) { this.lane = l; },
            jump() { if(!this.isJumping && !this.isRolling) { this.vY = 15; this.isJumping = true; }},
            roll() { if(!this.isJumping) { this.isRolling = true; this.rollTimer = 40; }},

            update() {
                this.score++;
                this.speed += 0.00001;
                
                // Physics
                if(this.isJumping) {
                    this.y += this.vY; this.vY -= 0.8;
                    if(this.y <= 0) { this.y = 0; this.isJumping = false; }
                }
                if(this.isRolling) {
                    this.rollTimer--;
                    if(this.rollTimer <= 0) this.isRolling = false;
                }

                // Spawn Obstacles & Coins
                if(Math.random() < 0.05) {
                    const type = Math.random() > 0.3 ? 'train' : 'coin';
                    this.objects.push({ lane: Math.floor(Math.random()*3)-1, z: 10, type: type });
                }

                for(let i=this.objects.length-1; i>=0; i--) {
                    let o = this.objects[i];
                    o.z -= this.speed;

                    // Collision Logic
                    if(o.z < 0.6 && o.z > 0.2 && o.lane === this.lane) {
                        if(o.type === 'coin') {
                            this.coins++; this.objects.splice(i, 1);
                        } else {
                            if(!this.isJumping && !this.isRolling) this.gameOver();
                            // Roll avoids high hurdles, Jump avoids low ones (Simplified for this build)
                        }
                    }
                    if(o.z < 0) this.objects.splice(i, 1);
                }
                document.getElementById('score').innerText = Math.floor(this.score/10);
                document.getElementById('coins').innerText = this.coins;
            },

            draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const cx = canvas.width/2; const horizon = canvas.height*0.2;

                // Draw Rails
                ctx.strokeStyle = '#555'; ctx.lineWidth = 3;
                [-1, 0, 1].forEach(l => {
                    ctx.beginPath(); ctx.moveTo(cx + l*20, horizon);
                    ctx.lineTo(cx + l*canvas.width, canvas.height); ctx.stroke();
                });

                // Draw Objects
                this.objects.sort((a,b) => b.z - a.z).forEach(o => {
                    let s = 1.5/o.z;
                    let x = cx + o.lane * (canvas.width * 0.4) * s;
                    let y = horizon + (canvas.height - horizon) * s;
                    let sz = 40 * s;

                    if(o.type === 'train') {
                        ctx.fillStyle = '#8B4513'; ctx.fillRect(x-sz, y-sz*2, sz*2, sz*2);
                        ctx.fillStyle = '#333'; ctx.fillRect(x-sz, y-sz*2, sz*2, sz*0.5); // Top of train
                    } else {
                        ctx.fillStyle = '#FFD700'; ctx.beginPath();
                        ctx.arc(x, y-sz/2, sz/2, 0, Math.PI*2); ctx.fill();
                    }
                });

                // Draw Player (The "Subway Boy")
                let pX = cx + this.lane * (canvas.width * 0.35) * 0.8;
                let pY = (canvas.height * 0.85) - this.y;
                let pSize = this.isRolling ? 20 : 50;

                // Head (Red Cap)
                ctx.fillStyle = 'red'; ctx.fillRect(pX-10, pY-pSize-15, 20, 10);
                // Body (Blue Hoodie)
                ctx.fillStyle = 'blue'; ctx.fillRect(pX-15, pY-pSize, 30, pSize);
                // Legs
                ctx.fillStyle = '#333'; ctx.fillRect(pX-12, pY, 10, 10); ctx.fillRect(pX+2, pY, 10, 10);
            },

            gameOver() { this.active = false; document.getElementById('deathMsg').style.display = 'flex'; },
            loop() { if(this.active) { this.update(); this.draw(); requestAnimationFrame(() => this.loop()); }}
        };

        game.init();
    </script>
</body>
</html>
